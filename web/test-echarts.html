<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test ECharts</title>
    <link rel="stylesheet" href="/assets/css/tabler.min.css">
    <style>
        body {
            padding: 40px;
            background: #1e1e2e;
            color: #fff;
            font-family: system-ui;
        }
        .status {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 600;
        }
        .success { background: #2d5f2e; }
        .error { background: #5f2d2d; }
        .warning { background: #5f4d2d; }
        .info { background: #2d3e5f; }

        #chart-container {
            width: 100%;
            height: 400px;
            background: #2a2a3e;
            border-radius: 8px;
            margin: 20px 0;
        }

        .debug-section {
            background: #2a2a3e;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .debug-section h3 {
            margin-top: 0;
            color: #00a896;
        }

        .code {
            background: #1e1e2e;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            overflow-x: auto;
            white-space: pre-wrap;
        }

        .test-list {
            list-style: none;
            padding: 0;
        }

        .test-list li {
            padding: 8px;
            margin: 5px 0;
            border-radius: 4px;
        }

        .test-pass { background: #2d5f2e; }
        .test-fail { background: #5f2d2d; }
    </style>
</head>
<body>
    <h1>üß™ Test de chargement ECharts</h1>

    <div id="status" class="status info">Test en cours...</div>

    <div class="debug-section">
        <h3>Tests de base</h3>
        <ul id="test-results" class="test-list"></ul>
    </div>

    <div class="debug-section">
        <h3>Graphique de test</h3>
        <div id="chart-container"></div>
    </div>

    <div class="debug-section">
        <h3>Informations de debug</h3>
        <div id="debug-info" class="code"></div>
    </div>

    <div class="debug-section">
        <h3>Console d'erreurs</h3>
        <div id="console-log" class="code"></div>
    </div>

    <!-- Load ECharts -->
    <script src="/assets/js/echarts.simple.min.js"></script>

    <script>
        const statusDiv = document.getElementById('status');
        const testResultsDiv = document.getElementById('test-results');
        const debugInfoDiv = document.getElementById('debug-info');
        const consoleLogDiv = document.getElementById('console-log');

        let tests = [];
        let debugInfo = [];
        let consoleLog = [];

        // Capture console logs
        const originalLog = console.log;
        const originalError = console.error;
        const originalWarn = console.warn;

        console.log = function(...args) {
            consoleLog.push('[LOG] ' + args.join(' '));
            originalLog.apply(console, args);
            updateConsole();
        };

        console.error = function(...args) {
            consoleLog.push('[ERROR] ' + args.join(' '));
            originalError.apply(console, args);
            updateConsole();
        };

        console.warn = function(...args) {
            consoleLog.push('[WARN] ' + args.join(' '));
            originalWarn.apply(console, args);
            updateConsole();
        };

        function addTest(name, passed, details) {
            tests.push({ name, passed, details });
            updateTests();
        }

        function addDebugInfo(info) {
            debugInfo.push(info);
            updateDebugInfo();
        }

        function updateTests() {
            testResultsDiv.innerHTML = tests.map(test =>
                `<li class="${test.passed ? 'test-pass' : 'test-fail'}">
                    ${test.passed ? '‚úÖ' : '‚ùå'} ${test.name}
                    ${test.details ? '<br><small>' + test.details + '</small>' : ''}
                </li>`
            ).join('');
        }

        function updateDebugInfo() {
            debugInfoDiv.textContent = debugInfo.join('\n');
        }

        function updateConsole() {
            consoleLogDiv.textContent = consoleLog.join('\n');
        }

        function runTests() {
            console.log('=== D√©but des tests ECharts ===');

            // Test 1: V√©rifier si echarts existe
            if (typeof echarts !== 'undefined') {
                addTest('Variable echarts existe', true, 'typeof echarts = ' + typeof echarts);
                addDebugInfo('‚úì window.echarts est d√©fini');
            } else {
                addTest('Variable echarts existe', false, 'echarts is undefined');
                addDebugInfo('‚úó window.echarts est undefined');
                statusDiv.className = 'status error';
                statusDiv.textContent = '‚ùå ERREUR: ECharts n\'est pas charg√©!';
                return;
            }

            // Test 2: V√©rifier la version
            try {
                const version = echarts.version || 'version inconnue';
                addTest('Version ECharts d√©tect√©e', true, 'Version: ' + version);
                addDebugInfo('Version ECharts: ' + version);
            } catch (e) {
                addTest('Version ECharts d√©tect√©e', false, e.message);
                addDebugInfo('Erreur version: ' + e.message);
            }

            // Test 3: V√©rifier echarts.init
            if (typeof echarts.init === 'function') {
                addTest('Fonction echarts.init disponible', true);
                addDebugInfo('‚úì echarts.init est une fonction');
            } else {
                addTest('Fonction echarts.init disponible', false);
                addDebugInfo('‚úó echarts.init n\'est pas une fonction');
            }

            // Test 4: Tester la cr√©ation d'un graphique
            try {
                const container = document.getElementById('chart-container');
                const chart = echarts.init(container);

                addTest('Initialisation d\'un graphique', true, 'Chart instance cr√©√©e');
                addDebugInfo('‚úì Chart instance: ' + (chart ? 'OK' : 'FAIL'));

                // Test 5: Configurer le graphique
                const option = {
                    title: {
                        text: 'Test ECharts - Graphique de d√©monstration',
                        textStyle: { color: '#fff' }
                    },
                    tooltip: {},
                    xAxis: {
                        type: 'category',
                        data: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                        axisLabel: { color: '#fff' },
                        axisLine: { lineStyle: { color: '#666' } }
                    },
                    yAxis: {
                        type: 'value',
                        axisLabel: { color: '#fff' },
                        axisLine: { lineStyle: { color: '#666' } },
                        splitLine: { lineStyle: { color: '#333' } }
                    },
                    series: [{
                        name: 'Voltage',
                        type: 'line',
                        data: [48.2, 50.5, 52.1, 51.8, 53.2, 52.9, 54.0],
                        smooth: true,
                        lineStyle: { color: '#00a896', width: 3 },
                        itemStyle: { color: '#00a896' },
                        areaStyle: {
                            color: {
                                type: 'linear',
                                x: 0, y: 0, x2: 0, y2: 1,
                                colorStops: [
                                    { offset: 0, color: 'rgba(0, 168, 150, 0.3)' },
                                    { offset: 1, color: 'rgba(0, 168, 150, 0.05)' }
                                ]
                            }
                        }
                    }],
                    backgroundColor: '#2a2a3e'
                };

                chart.setOption(option);
                addTest('Configuration du graphique', true, 'Option setOption() OK');
                addDebugInfo('‚úì Graphique configur√© avec succ√®s');

                // Test 6: V√©rifier que le graphique est rendu
                setTimeout(() => {
                    const canvas = container.querySelector('canvas');
                    if (canvas) {
                        addTest('Rendu du graphique (canvas)', true, 'Canvas cr√©√©: ' + canvas.width + 'x' + canvas.height);
                        addDebugInfo('‚úì Canvas dimensions: ' + canvas.width + 'x' + canvas.height);
                        statusDiv.className = 'status success';
                        statusDiv.textContent = '‚úÖ ECharts fonctionne parfaitement!';
                    } else {
                        addTest('Rendu du graphique (canvas)', false, 'Canvas non trouv√©');
                        addDebugInfo('‚úó Canvas non cr√©√©');
                        statusDiv.className = 'status warning';
                        statusDiv.textContent = '‚ö†Ô∏è ECharts charg√© mais canvas non cr√©√©';
                    }
                }, 500);

            } catch (e) {
                addTest('Cr√©ation du graphique', false, e.message);
                addDebugInfo('‚úó Erreur: ' + e.message);
                addDebugInfo('Stack: ' + e.stack);
                statusDiv.className = 'status error';
                statusDiv.textContent = '‚ùå ERREUR lors de la cr√©ation du graphique';
                console.error('Erreur ECharts:', e);
            }

            // Test 7: Lister les propri√©t√©s disponibles
            if (typeof echarts !== 'undefined') {
                const props = Object.keys(echarts).slice(0, 20);
                addDebugInfo('\nPropri√©t√©s ECharts disponibles (20 premi√®res):');
                addDebugInfo(props.join(', '));
            }

            // Test 8: Informations sur le fichier charg√©
            const scripts = document.querySelectorAll('script[src*="echarts"]');
            addDebugInfo('\nScripts ECharts trouv√©s: ' + scripts.length);
            scripts.forEach((script, i) => {
                addDebugInfo(`Script ${i+1}: ${script.src}`);
            });

            console.log('=== Fin des tests ===');
        }

        // Attendre que le DOM et ECharts soient pr√™ts
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', () => {
                setTimeout(runTests, 100);
            });
        } else {
            setTimeout(runTests, 100);
        }
    </script>
</body>
</html>
