<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Extracteur CSS Tabler pour ESP32</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 1200px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { color: #333; text-align: center; }
        .section { margin: 20px 0; }
        label { display: block; margin-bottom: 8px; font-weight: bold; color: #555; }
        textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-family: monospace; font-size: 12px; }
        button { background: #007cba; color: white; padding: 12px 24px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; margin: 10px 0; }
        button:hover { background: #005a87; }
        .stats { background: #e8f4fd; padding: 15px; border-radius: 4px; margin: 15px 0; }
        .success { color: #2e7d32; font-weight: bold; }
        .warning { color: #ed6c02; }
        #result { background: #f8f9fa; }
    </style>
</head>
<body>
    <div class="container">
        <h1>üîß Extracteur CSS Tabler pour ESP32</h1>
        
        <div class="section">
            <label for="originalCss">1. CSS Original Tabler (collez vos 540KB ici) :</label>
            <textarea id="originalCss" rows="8" placeholder="Collez le contenu complet de tabler.min.css ici..."></textarea>
        </div>

        <div class="section">
            <label for="usedClasses">2. Classes utilis√©es (d√©j√† pr√©-remplies) :</label>
            <textarea id="usedClasses" rows="12">active
align-items-center
align-items-end
align-items-lg-center
align-items-start
col
col-12
col-6
col-lg-4
col-lg-6
col-lg-8
col-md-4
col-sm-6
col-sm-6 col-lg-3
col-sm-6 col-lg-4
col-sm-6 col-xl-3
col-xl-4
col-xl-5
col-xl-7
container-xl
d-block
d-flex
d-none
flex-column
flex-grow-1
flex-wrap
flex-wrap align-items-center gap-2
g-3
g-4
gap-1
gap-2
gap-3
h-100
justify-content-between
justify-content-end
me-1
ms-auto
mt-2
mt-3
mt-4
p-0
py-3
row
row-cards
w-100
app-header
branding
navbar
navbar-brand
navbar-brand-text
navbar-dark
navbar-expand-md
navbar-nav
nav-item
nav-link
nav-tabs
card
card-body
card-footer
card-header
card-stacked
card-stats
card-subtitle
card-title
config-card
config-description
config-form-actions
config-form-grid
config-grid
config-header
config-header-actions
config-header-text
config-subheading
btn
btn-outline-primary
btn-outline-secondary
btn-primary
btn-sm
button
disabled
segmented-control
segmented-control-label
segmented-control-sm
tab-button
tab-panel
checkbox
form-check
form-check-input
form-check-label
form-control
form-label
form-row
form-select
form-select-sm
invalid-feedback
mqtt-form
mqtt-layout
badge
bg-blue-lt
bg-body-secondary
bg-cyan-lt
bg-danger
bg-green-lt
bg-orange-lt
bg-primary
bg-primary-lt
bg-secondary
bg-secondary-lt
bg-warning-lt
cell-balancing-badges
status-badge
status-badge--connected
status-badge--disconnected
status-badge--error
status-grid
status-icon
status-indicator
status-kv
list-group
list-group-flush
table
table-responsive
table-striped
table-vcenter
page
page-body
page-item
page-link
pagination
display-6
fs-2
fs-6
fw-bold
fw-semibold
mb-0
mb-1
mb-2
mb-3
mb-4
small
subtitle
text-blue
text-cyan
text-danger
text-green
text-info
text-orange
text-secondary
text-success
text-uppercase
text-warning
text-white
ti
ti-alert-circle
ti-alert-triangle
ti-antenna-bars-5
ti-battery
ti-bolt
ti-current-ac
ti-device-analytics
ti-info-circle
ti-settings-code
ti-temperature
ti-terminal-2
avatar
avatar-lg
aria-controls
aria-expanded
aria-label
aria-labelledby
aria-live
border-0
collapsed
echart-container
error
history-archive-controls
history-archive-controls card bg-body-secondary border-0 mt-3 d-none
history-chart
history-info
history-toolbar
primary
role
secondary
shadow-sm
show
success
theme-dark
visually-hidden</textarea>
        </div>

        <button onclick="extractCSS()" style="background: #2e7d32;">üöÄ Extraire le CSS r√©duit</button>

        <div class="stats" id="stats">
            <strong>Statistiques :</strong>
            <div id="statContent">En attente d'extraction...</div>
        </div>

        <div class="section">
            <label for="result">3. CSS R√©duit (r√©sultat) :</label>
            <textarea id="result" rows="15" readonly placeholder="Le CSS extrait appara√Ætra ici..."></textarea>
        </div>

        <button onclick="downloadCSS()" style="background: #ed6c02;" id="downloadBtn" disabled>üíæ T√©l√©charger tabler-reduit.css</button>
    </div>

    <script>
        // Votre liste de classes int√©gr√©e directement dans le code
        const defaultClasses = [
            'active', 'align-items-center', 'align-items-end', 'align-items-lg-center', 'align-items-start',
            'app-header', 'aria-controls', 'aria-expanded', 'aria-label', 'aria-labelledby', 'aria-live',
            'avatar', 'avatar-lg', 'badge', 'bg-blue-lt', 'bg-body-secondary', 'bg-cyan-lt', 'bg-danger',
            'bg-green-lt', 'bg-orange-lt', 'bg-primary', 'bg-primary-lt', 'bg-secondary', 'bg-secondary-lt',
            'bg-warning-lt', 'border-0', 'branding', 'btn', 'btn-outline-primary', 'btn-outline-secondary',
            'btn-primary', 'btn-sm', 'button', 'card', 'card-body', 'card-footer', 'card-header', 'card-stacked',
            'card-stats', 'card-subtitle', 'card-title', 'cell-balancing-badges', 'cell-section', 'cell-section-header',
            'chart-gauge', 'chart-sparkline', 'checkbox', 'col', 'col-12', 'col-6', 'col-lg-4', 'col-lg-6',
            'col-lg-8', 'col-md-4', 'col-sm-6', 'col-sm-6 col-lg-3', 'col-sm-6 col-lg-4', 'col-sm-6 col-xl-3',
            'col-xl-4', 'col-xl-5', 'col-xl-7', 'collapsed', 'config-card', 'config-description', 'config-form-actions',
            'config-form-grid', 'config-grid', 'config-header', 'config-header-actions', 'config-header-text',
            'config-subheading', 'container-xl', 'd-block', 'd-flex', 'd-none', 'disabled', 'display-6',
            'echart-container', 'error', 'flex-column', 'flex-grow-1', 'flex-wrap', 'flex-wrap align-items-center gap-2',
            'form-check', 'form-check-input', 'form-check-label', 'form-control', 'form-label', 'form-row',
            'form-select', 'form-select-sm', 'fw-bold', 'fw-semibold', 'fs-2', 'fs-6', 'g-3', 'g-4', 'gap-1',
            'gap-2', 'gap-3', 'h-100', 'history-archive-controls', 'history-chart', 'history-info', 'history-toolbar',
            'invalid-feedback', 'justify-content-between', 'justify-content-end', 'list-group', 'list-group-flush',
            'mb-0', 'mb-1', 'mb-2', 'mb-3', 'mb-4', 'me-1', 'mqtt-form', 'mqtt-layout', 'ms-auto', 'mt-2', 'mt-3',
            'mt-4', 'nav-item', 'nav-link', 'nav-tabs', 'navbar', 'navbar-brand', 'navbar-brand-text', 'navbar-dark',
            'navbar-expand-md', 'navbar-nav', 'page', 'page-body', 'page-item', 'page-link', 'p-0', 'pagination',
            'primary', 'py-3', 'role', 'row', 'row-cards', 'secondary', 'segmented-control', 'segmented-control-label',
            'segmented-control-sm', 'shadow-sm', 'show', 'small', 'status-badge', 'status-badge--connected',
            'status-badge--disconnected', 'status-badge--error', 'status-grid', 'status-icon', 'status-indicator',
            'status-kv', 'subtitle', 'success', 'tab-button', 'tab-panel', 'table', 'table-responsive', 'table-striped',
            'table-vcenter', 'text-blue', 'text-cyan', 'text-danger', 'text-green', 'text-info', 'text-orange',
            'text-secondary', 'text-success', 'text-uppercase', 'text-warning', 'text-white', 'theme-dark', 'ti',
            'ti-alert-circle', 'ti-alert-triangle', 'ti-antenna-bars-5', 'ti-battery', 'ti-bolt', 'ti-current-ac',
            'ti-device-analytics', 'ti-info-circle', 'ti-settings-code', 'ti-temperature', 'ti-terminal-2', 'timeline',
            'timeline-compact', 'timeline-item', 'timeline-item-content', 'timeline-item-description',
            'timeline-item-marker', 'timeline-item-time', 'timeline-item-title', 'visually-hidden', 'w-100',
            'was-validated', '02', '02em', '03', '04', '04em', '05', '05em', '08', '1', '12', '15', '18', '1rem',
            '2', '22', '25', '25rem', '2rem', '2s', '3', '35', '35rem', '3s', '4', '4rem', '5', '55', '55rem',
            '5rem', '6', '65rem', '6rem', '7', '75', '75rem', '85rem', '8rem', '95', '95rem', '9rem'
        ];

        function extractCSS() {
            const originalCSS = document.getElementById('originalCss').value;
            const usedClassesText = document.getElementById('usedClasses').value;
            
            // Utiliser les classes du textarea ou les classes par d√©faut
            const usedClasses = usedClassesText 
                ? usedClassesText.split('\n').map(c => c.trim()).filter(c => c)
                : defaultClasses;
            
            if (!originalCSS) {
                alert('Veuillez coller le CSS original Tabler');
                return;
            }

            const rules = originalCSS.split('}');
            const extracted = [];
            let matchedSelectors = new Set();

            rules.forEach(rule => {
                const parts = rule.split('{');
                if (parts.length === 2) {
                    const selector = parts[0].trim();
                    const declarations = parts[1];
                    
                    // V√©rifier si le s√©lecteur contient une classe utilis√©e
                    const hasUsedClass = usedClasses.some(cls => {
                        // G√©rer les s√©lecteurs avec points, espaces, etc.
                        return selector.includes('.' + cls) || 
                               selector.includes('.' + cls + ' ') ||
                               selector.includes('.' + cls + ':') ||
                               selector.includes('.' + cls + '[') ||
                               selector.includes('.' + cls + '.') ||
                               selector.includes('.' + cls + '>') ||
                               selector.includes('.' + cls + '~') ||
                               selector.includes('.' + cls + '+') ||
                               selector === '.' + cls;
                    });

                    if (hasUsedClass) {
                        extracted.push(rule + '}');
                        matchedSelectors.add(selector);
                    }
                }
            });

            const resultCSS = extracted.join('\n');
            document.getElementById('result').value = resultCSS;

            // Calcul des statistiques
            const originalSize = new Blob([originalCSS]).size;
            const extractedSize = new Blob([resultCSS]).size;
            const reduction = ((originalSize - extractedSize) / originalSize * 100).toFixed(1);
            const kbSaved = (originalSize - extractedSize) / 1024;

            const statsHTML = `
                <div class="success">‚úÖ <strong>R√©duction r√©ussie !</strong></div>
                <div>Taille originale: <strong>${(originalSize/1024).toFixed(1)} KB</strong></div>
                <div>Taille r√©duite: <strong>${(extractedSize/1024).toFixed(1)} KB</strong></div>
                <div>√âconomie: <strong>${reduction}% (${kbSaved.toFixed(0)} KB sauv√©s)</strong></div>
                <div>S√©lecteurs correspondants: <strong>${matchedSelectors.size}</strong></div>
                <div>Classes recherch√©es: <strong>${usedClasses.length}</strong></div>
            `;

            document.getElementById('statContent').innerHTML = statsHTML;
            document.getElementById('downloadBtn').disabled = false;

            console.log('Extraction termin√©e:', {
                originalKB: (originalSize/1024).toFixed(1),
                extractedKB: (extractedSize/1024).toFixed(1),
                reduction: reduction + '%',
                selectors: matchedSelectors.size
            });
        }

        function downloadCSS() {
            const cssContent = document.getElementById('result').value;
            if (!cssContent) {
                alert('Aucun CSS √† t√©l√©charger');
                return;
            }

            const blob = new Blob([cssContent], { type: 'text/css' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'tabler-reduit.css';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        // Initialisation
        document.getElementById('usedClasses').value = defaultClasses.join('\n');
    </script>
</body>
</html>
