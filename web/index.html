<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>TinyBMS Web Gateway</title>
    <link rel="stylesheet" href="./node_modules/@tabler/core/dist/css/tabler.min.css" />
    <link rel="stylesheet" href="./node_modules/@tabler/icons-webfont/dist/tabler-icons.min.css" />
    <link rel="stylesheet" href="./style.css" />
  </head>
  <body class="theme-dark">
    <div id="app" class="page">
      <div data-partial="./src/layout/header.html"></div>
      <div data-partial="./src/layout/main.html"></div>
    </div>
    <script defer src="./node_modules/@tabler/core/dist/js/tabler.min.js"></script>
    <script type="module">
      async function loadPartials() {
        let placeholders = Array.from(document.querySelectorAll('[data-partial]'));

        while (placeholders.length) {
          await Promise.all(
            placeholders.map(async (placeholder) => {
              const url = placeholder.getAttribute('data-partial');
              if (!url) {
                return;
              }
              try {
                const response = await fetch(url);
                if (!response.ok) {
                  throw new Error(`Impossible de charger le fragment ${url}`);
                }
                const markup = await response.text();
                placeholder.outerHTML = markup.trim();
              } catch (error) {
                console.error(error);
                placeholder.removeAttribute('data-partial');
              }
            })
          );

          placeholders = Array.from(document.querySelectorAll('[data-partial]'));
        }
      }

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', loadPartials);
      } else {
        loadPartials();
      }
    </script>
    <script src="./dashboard.js" type="module"></script>
  </body>
</html>
