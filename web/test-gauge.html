<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Jauge D√©taill√©</title>
    <style>
        body {
            background: #1e293b;
            color: white;
            font-family: Arial, sans-serif;
            padding: 20px;
            margin: 0;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        #gauge-container {
            width: 600px;
            height: 400px;
            background: #334155;
            margin: 20px 0;
            border: 2px solid #10b981;
            box-sizing: border-box;
        }
        .log {
            background: #0f172a;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 400px;
            overflow-y: auto;
        }
        .log-entry {
            padding: 2px 0;
        }
        .success { color: #10b981; }
        .error { color: #ef4444; }
        .info { color: #3b82f6; }
        .warn { color: #f59e0b; }
        h1 { color: #10b981; }
        h2 { color: #3b82f6; margin-top: 30px; }
        button {
            background: #10b981;
            color: white;
            border: none;
            padding: 12px 24px;
            margin: 5px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
        }
        button:hover {
            background: #059669;
        }
        .stats {
            background: #0f172a;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üî¨ Test Jauge ECharts - Mode Debug</h1>

        <div class="log" id="log"></div>

        <h2>üìä Jauge de Test</h2>
        <div class="stats" id="container-stats"></div>
        <div id="gauge-container"></div>

        <div>
            <button onclick="updateGauge(25)">25%</button>
            <button onclick="updateGauge(50)">50%</button>
            <button onclick="updateGauge(75)">75%</button>
            <button onclick="updateGauge(100)">100%</button>
            <button onclick="reinitChart()">üîÑ R√©initialiser</button>
        </div>
    </div>

    <script src="/assets/js/echarts.common.min.js"></script>
    <script>
        const logDiv = document.getElementById('log');
        const statsDiv = document.getElementById('container-stats');
        let chart = null;
        let logCount = 0;

        function log(message, type = 'info') {
            logCount++;
            const time = new Date().toLocaleTimeString();
            const ms = new Date().getMilliseconds().toString().padStart(3, '0');
            const className = type;
            const icon = type === 'error' ? '‚ùå' : type === 'success' ? '‚úÖ' : type === 'warn' ? '‚ö†Ô∏è' : '‚ÑπÔ∏è';
            logDiv.innerHTML = '<div class="log-entry ' + className + '">' + icon + ' [' + time + '.' + ms + '] ' + message + '</div>' + logDiv.innerHTML;
            console.log('[' + logCount + '] ' + message);
        }

        function updateStats() {
            const container = document.getElementById('gauge-container');
            const rect = container.getBoundingClientRect();
            const computed = window.getComputedStyle(container);

            statsDiv.innerHTML = '<strong>üìê Dimensions du conteneur:</strong><br>' +
                'Width: ' + rect.width + 'px (computed: ' + computed.width + ')<br>' +
                'Height: ' + rect.height + 'px (computed: ' + computed.height + ')<br>' +
                'Display: ' + computed.display + '<br>' +
                'Visibility: ' + computed.visibility + '<br>' +
                'Opacity: ' + computed.opacity;
        }

        function inspectDOM() {
            const container = document.getElementById('gauge-container');
            log('Inspection du conteneur...', 'info');
            log('Enfants directs: ' + container.children.length, 'info');

            for (let i = 0; i < container.children.length; i++) {
                const child = container.children[i];
                log('Enfant ' + i + ': ' + child.tagName, 'info');
                log('  Classes: ' + child.className, 'info');
                log('  Style: ' + child.getAttribute('style'), 'info');

                const childRect = child.getBoundingClientRect();
                log('  Dimensions: ' + childRect.width + 'x' + childRect.height, 'info');

                if (child.tagName === 'CANVAS') {
                    log('  Canvas trouv√© !', 'success');
                    log('  Canvas width: ' + child.width, 'info');
                    log('  Canvas height: ' + child.height, 'info');

                    const ctx = child.getContext('2d');
                    if (ctx) {
                        log('  Context 2D disponible', 'success');

                        // V√©rifier si le canvas a du contenu
                        const imageData = ctx.getImageData(0, 0, 1, 1);
                        log('  Pixels test: ' + JSON.stringify(Array.from(imageData.data)), 'info');
                    }
                }

                // Inspecter les petits-enfants
                log('  Sous-enfants: ' + child.children.length, 'info');
                if (child.children.length > 0) {
                    for (let j = 0; j < child.children.length; j++) {
                        const subChild = child.children[j];
                        log('    Sous-enfant ' + j + ': ' + subChild.tagName, 'info');
                        if (subChild.tagName.toUpperCase() === 'CANVAS') {
                            log('    Canvas trouv√© dans sous-enfant !', 'success');
                            log('    Canvas width: ' + subChild.width, 'info');
                            log('    Canvas height: ' + subChild.height, 'info');
                        }
                        if (subChild.tagName.toUpperCase() === 'SVG') {
                            log('    SVG trouv√© dans sous-enfant !', 'success');
                            const svgRect = subChild.getBoundingClientRect();
                            log('    SVG dimensions: ' + svgRect.width + 'x' + svgRect.height, 'info');
                            log('    SVG viewBox: ' + subChild.getAttribute('viewBox'), 'info');
                            log('    SVG width attr: ' + subChild.getAttribute('width'), 'info');
                            log('    SVG height attr: ' + subChild.getAttribute('height'), 'info');
                            log('    SVG style: ' + subChild.getAttribute('style'), 'info');
                            log('    SVG enfants: ' + subChild.children.length, 'info');
                            
                            if (subChild.children.length === 0) {
                                log('    ‚ö†Ô∏è SVG est VIDE !', 'warn');
                            } else {
                                log('    Premier enfant SVG: ' + subChild.children[0].tagName, 'info');
                                // Afficher les 5 premiers √©l√©ments SVG
                                for (let k = 0; k < Math.min(5, subChild.children.length); k++) {
                                    const svgChild = subChild.children[k];
                                    log('      SVG[' + k + ']: ' + svgChild.tagName + ' (' + svgChild.getAttribute('class') + ')', 'info');
                                }
                            }
                            
                            // Tester le innerHTML
                            const innerLength = (subChild.innerHTML || '').length;
                            log('    SVG innerHTML length: ' + innerLength + ' chars', 'info');
                            if (innerLength < 100) {
                                log('    SVG innerHTML: ' + subChild.innerHTML, 'warn');
                            }
                        }
                    }
                } else {
                    log('  ‚ö†Ô∏è DIV est VIDE - pas de canvas/svg cr√©√© !', 'warn');
                }
            }

            if (container.children.length === 0) {
                log('PROBL√àME: Aucun enfant dans le conteneur !', 'error');
            }
        }

        log('üöÄ D√©marrage de la page', 'info');
        updateStats();

        function initializeGauge() {
            log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'info');
            log('D√©but de l\'initialisation', 'info');
            
            // Check echarts
            log('V√©rification de window.echarts...', 'info');
            if (typeof window.echarts === 'undefined') {
                log('window.echarts est undefined !', 'error');
                return;
            }
            log('window.echarts disponible (v' + window.echarts.version + ')', 'success');

            // Check container
            log('R√©cup√©ration du conteneur...', 'info');
            const container = document.getElementById('gauge-container');
            if (!container) {
                log('Conteneur introuvable !', 'error');
                return;
            }
            log('Conteneur trouv√©', 'success');

            // Check dimensions
            const rect = container.getBoundingClientRect();
            log('Dimensions: ' + rect.width + 'x' + rect.height, 'info');
            if (rect.width === 0 || rect.height === 0) {
                log('ATTENTION: Conteneur a une dimension 0 !', 'warn');
            }

            try {
                log('Appel de echarts.init()...', 'info');
                chart = window.echarts.init(container, null, {
                    renderer: 'svg',
                    width: 600,
                    height: 400
                });
                log('Chart cr√©√© avec succ√®s', 'success');
                log('Type de chart: ' + typeof chart, 'info');
                log('Chart.id: ' + chart.id, 'info');

                log('Pr√©paration des options...', 'info');
                const option = {
                    backgroundColor: 'transparent',
                    series: [{
                        type: 'gauge',
                        startAngle: 200,
                        endAngle: -20,
                        min: 0,
                        max: 100,
                        splitNumber: 10,
                        radius: '70%',
                        center: ['50%', '50%'],
                        axisLine: {
                            lineStyle: {
                                width: 30,
                                color: [
                                    [0.3, '#ef4444'],
                                    [0.7, '#f59e0b'],
                                    [1, '#10b981']
                                ]
                            }
                        },
                        pointer: {
                            itemStyle: {
                                color: '#ffffff'
                            },
                            width: 8,
                            length: '60%'
                        },
                        axisTick: {
                            distance: -35,
                            length: 8,
                            lineStyle: {
                                color: '#fff',
                                width: 2
                            }
                        },
                        splitLine: {
                            distance: -40,
                            length: 20,
                            lineStyle: {
                                color: '#fff',
                                width: 3
                            }
                        },
                        axisLabel: {
                            color: '#ffffff',
                            distance: 50,
                            fontSize: 18,
                            fontWeight: 'bold'
                        },
                        title: {
                            show: false
                        },
                        detail: {
                            valueAnimation: true,
                            formatter: '{value}%',
                            color: '#ffffff',
                            fontSize: 50,
                            fontWeight: 'bold',
                            offsetCenter: [0, '80%']
                        },
                        data: [{
                            value: 0,
                            name: 'Test'
                        }]
                    }]
                };

                log('Application des options avec setOption()...', 'info');
                chart.setOption(option);
                log('Options appliqu√©es', 'success');

                // Inspecter le DOM
                log('‚ïê‚ïê‚ïê INSPECTION DU DOM ‚ïê‚ïê‚ïê', 'info');
                setTimeout(function() {
                    inspectDOM();
                }, 200);

                // Test update apr√®s 500ms
                log('Programmation d\'une mise √† jour test...', 'info');
                setTimeout(function() {
                    log('Mise √† jour vers 65%...', 'info');
                    try {
                        chart.setOption({
                            series: [{
                                data: [{ value: 65 }]
                            }]
                        });
                        log('Valeur mise √† jour √† 65%', 'success');
                    } catch (e) {
                        log('Erreur lors de la mise √† jour: ' + e.message, 'error');
                    }
                }, 500);

                log('‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê', 'success');
                log('Initialisation termin√©e avec succ√®s', 'success');

            } catch (e) {
                log('ERREUR lors de l\'initialisation: ' + e.message, 'error');
                log('Stack: ' + e.stack, 'error');
            }
        }

        function updateGauge(value) {
            if (!chart) {
                log('Impossible de mettre √† jour: chart est null', 'error');
                return;
            }

            log('Mise √† jour vers ' + value + '%...', 'info');
            try {
                chart.setOption({
                    series: [{
                        data: [{ value: value }]
                    }]
                });
                log('Valeur mise √† jour √† ' + value + '%', 'success');
            } catch (e) {
                log('Erreur: ' + e.message, 'error');
            }
        }

        function reinitChart() {
            log('R√©initialisation...', 'warn');
            if (chart) {
                chart.dispose();
                chart = null;
                log('Chart dispos√©', 'info');
            }
            setTimeout(function() {
                initializeGauge();
            }, 100);
        }

        // Attendre que tout soit charg√©
        window.addEventListener('load', function() {
            log('√âv√©nement window.load d√©clench√©', 'info');
            setTimeout(function() {
                initializeGauge();
            }, 300);
        });

        // Mettre √† jour les stats p√©riodiquement
        setInterval(updateStats, 2000);
    </script>
</body>
</html>
